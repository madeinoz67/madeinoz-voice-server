openapi: 3.0.3
info:
  title: PAI Voice Server API
  description: Drop-in replacement for ElevenLabs-based voice server using Qwen TTS
  version: 2.0.0
  contact:
    name: PAI Project
    url: https://github.com/danielmiessler/Personal_AI_Infrastructure

servers:
  - url: http://localhost:8888
    description: Local development server

tags:
  - name: Notifications
    description: Voice notification endpoints
  - name: Health
    description: Server health and status

paths:
  /notify:
    post:
      tags: [Notifications]
      summary: Send voice notification
      description: Generates speech using Qwen TTS and displays macOS notification
      operationId: sendNotification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationRequest'
            examples:
              basic:
                summary: Basic notification
                value:
                  title: "Task Complete"
                  message: "The background job has finished successfully"
              withVoice:
                summary: With custom voice
                value:
                  title: "PAI Alert"
                  message: "Welcome to the Personal AI Infrastructure"
                  voice_id: "marrvin"
              withProsody:
                summary: With prosody override
                value:
                  title: "Important"
                  message: "This is an urgent announcement"
                  voice_id: "marrvin"
                  voice_settings:
                    stability: 0.8
                    speed: 1.2
                    style: 0.5
      responses:
        '200':
          description: Notification sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidInput:
                  summary: Invalid input
                  value:
                    status: "error"
                    message: "Invalid message: contains no valid content after sanitization"
                rateLimit:
                  summary: Rate limit exceeded
                  value:
                    status: "error"
                    message: "Rate limit exceeded"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pai:
    post:
      tags: [Notifications]
      summary: Send PAI notification with default voice
      description: Simplified endpoint using default DA voice settings
      operationId: sendPaiNotification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaiNotificationRequest'
            examples:
              basic:
                summary: PAI notification
                value:
                  title: "PAI Assistant"
                  message: "Analysis complete"
      responses:
        '200':
          description: PAI notification sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health:
    get:
      tags: [Health]
      summary: Get server health status
      description: Returns server status and configuration
      operationId: getHealth
      responses:
        '200':
          description: Server status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
              examples:
                healthy:
                  summary: Server with Qwen TTS
                  value:
                    status: "healthy"
                    port: 8888
                    voice_system: "Qwen TTS"
                    default_voice_id: "marrvin"
                    model_loaded: true
                    api_key_configured: false
                    python_subprocess: "running"
                fallback:
                  summary: Server using fallback
                  value:
                    status: "healthy"
                    port: 8888
                    voice_system: "macOS Say"
                    default_voice_id: ""
                    model_loaded: false
                    api_key_configured: false
                    python_subprocess: "stopped"

components:
  schemas:
    NotificationRequest:
      type: object
      required:
        - title
        - message
      properties:
        title:
          type: string
          maxLength: 100
          description: Notification title
          example: "Task Complete"
        message:
          type: string
          maxLength: 500
          description: Text to synthesize (will be sanitized)
          example: "The background job has finished successfully"
        voice_enabled:
          type: boolean
          default: true
          description: Whether to play audio
        voice_id:
          type: string
          description: Voice identifier (overrides default)
          example: "marrvin"
        voice_name:
          type: string
          description: Alias for voice_id
          example: "Marvin"
        voice_settings:
          $ref: '#/components/schemas/ProsodySettings'
        volume:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Playback volume override (0.0 = silent, 1.0 = full)

    PaiNotificationRequest:
      type: object
      required:
        - title
        - message
      properties:
        title:
          type: string
          maxLength: 100
          description: Notification title (defaults to "PAI Assistant")
          example: "PAI Assistant"
        message:
          type: string
          maxLength: 500
          description: Text to synthesize
          example: "Analysis complete"

    ProsodySettings:
      type: object
      description: Voice prosody configuration
      properties:
        stability:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 0.5
          description: Speaking consistency (higher = more stable/consistent)
        similarity_boost:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 0.75
          description: Voice cloning fidelity (for custom voices)
        style:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 0.0
          description: Expressiveness level
        speed:
          type: number
          minimum: 0.1
          maximum: 2.0
          default: 1.0
          description: Speaking rate multiplier
        use_speaker_boost:
          type: boolean
          default: true
          description: Enhance voice clarity
        volume:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Playback volume level

    SuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
          example: "success"
        message:
          type: string
          example: "Notification sent"

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
          example: "error"
        message:
          type: string
          example: "Invalid input"

    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: "healthy"
        port:
          type: integer
          example: 8888
        voice_system:
          type: string
          enum: [Qwen TTS, macOS Say, Unavailable]
          example: "Qwen TTS"
        default_voice_id:
          type: string
          example: "marrvin"
        model_loaded:
          type: boolean
          example: true
        api_key_configured:
          type: boolean
          description: Always false for Qwen (kept for API compatibility)
          example: false
        python_subprocess:
          type: string
          enum: [running, stopped, crashed]
          example: "running"

  securitySchemes:
    cors:
      type: apiKey
      in: header
      name: Origin
      description: CORS restricted to localhost only

security:
  - cors: []
